{% extends "profile/profile-base.html" %}

{% load habit_tags %}

{% block gallery %}

<main>


	<div class="container">

		<div class="gallery-feed">

			{% block content %}


				{% include 'posts/grid-post-preview.html' with habit_post=post truncate=True detail=False %} <!-- Created a new variable to pass object in as --> 


			{% endblock %}
			<div class="post-details">
				<a href="{{ profile_url }}">{{ profile_user.username }}</a>
				{{ post.description }}
				{% if post.post_likes.all %}
				{{ post.post_likes.all|length }}❤️️
				{% endif %}
			</div>




			<button id="about-btn" onclick="LikePost()"> about btn </button>

			<button id="go" onclick="greet()">Say hello</button>

			<button id="button" onclick="init()">DOM button</button>

			<div id="result"></div>


			<div>
				{% for c in post.comments.all %}
				{% if c.parent is None %}
				<p>{{ c.timestamp }} {{ c.user }} {{ c.comment }}<button type="reply-button" value ="Add Child" onclick="addChild({{ c.pk }});">Reply</button> <span><button type="reply-button" value ="Add Child" >
					{% is_liked_by_user c request.user as liked %}
					{% if liked %}
					unlike
					{% else %}

					Like
					{% endif %}</button>

					{% if c.comment_likes.all %}
					{{ c.comment_likes.all|length }}❤️️

					{% else %}
					Like
					{% endif %}
					</span>
				</p>
					{% for r in c.replies.all %}
						<p>-----{{ r.timestamp }} {{ r.user }} {{ r.comment }}
							{% if r.comment_likes.all %}
							{{ r.comment_likes.all|length }}❤️️
							{% endif %}
						</p>
					{% endfor %}



					<div class="reply-to-comment" id="{{ c.pk }}" style="display: none">
					<form>
						{{ c.pk }}
						{% csrf_token %}
    					{{ form.as_p }}
    					<button type='submit'>Post</button>
					</form>
					</div>

				{% endif %}
				{% endfor %}
			</div>
			<form method='POST' action='.' class="add-comment"> 
				{% csrf_token %}
    			{{ form.as_p }}
				<button type='submit'>Post</button>
			</form>



			<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

			<script type="text/javascript">
				$(document).ready( 
					alert("something something");
					function() {


				    $("#about-btn").click( function(event) {
				        alert("You clicked the button using JQuery!");
				    });
				});
			</script>


			<script type="text/javascript">
    			$(document).ready(function() {

		        	$('#thumb').click(function () {
			            $.ajax({
			                type: 'POST',
			                url: {% url 'PostLikeToggle' %},
			                data: {
			                    'post_id': {{ habit_post }},
			                    'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
			                },
			                success: LikePost,
			                dataType: 'html'
			            });



			            function LikePost(data, jqXHR) {

			            	alert("You clicked the button using JQuery!");
			                var data = $.parseJSON(data)
			                if (data['liked']) {
			                    $('#thumb').removeClass("fas fa-thumbs-up").addClass('far fa-thumbs-up')
			                } else {
			                    $('#thumb').removeClass("far fa-thumbs-up").addClass('fas fa-thumbs-up')
			                }


			            }
		        	});
		        });
        	</script>
			
		</div>
		<!-- End of gallery -->

		<div class="loader"></div>

	</div>
	<!-- End of container -->

</main>

{% endblock %}